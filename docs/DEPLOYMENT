# Portainer éƒ¨ç½²åæ— æ³•è®¿é—®åº”ç”¨ - è§£å†³æ–¹æ¡ˆ

## é—®é¢˜ç°è±¡

- Flaskåº”ç”¨åœ¨å®¹å™¨å†…è¿è¡Œ: `Running on http://172.22.0.3:5000`
- ä½†å¤–éƒ¨æ— æ³•è®¿é—® `http://172.22.0.3:5000`
- 172.22.0.3 æ˜¯å®¹å™¨å†…éƒ¨IPï¼Œä¸æ˜¯å¯å¤–éƒ¨è®¿é—®çš„åœ°å€

## æ ¹æœ¬åŸå› 

**172.22.0.3 æ˜¯Dockerå®¹å™¨çš„å†…éƒ¨ç½‘ç»œIPåœ°å€**

è®¿é—®æ—¶åº”è¯¥ä½¿ç”¨ï¼š
- **æœ¬åœ°è®¿é—®**: `http://localhost:5000` æˆ– `http://127.0.0.1:5000`
- **è¿œç¨‹è®¿é—®**: `http://docker-host-ip:5000` (Dockerä¸»æœºçš„å®é™…IP)
- **ä»å®¹å™¨å†…è®¿é—®**: `http://proto-sap-backend:5000` (å®¹å™¨åç§°)

## ğŸ“‹ è¯Šæ–­æ­¥éª¤

### 1ï¸âƒ£ æ£€æŸ¥å®¹å™¨çŠ¶æ€

åœ¨Portainerä¸­ï¼š
1. è¿›å…¥ **Containers**
2. æŸ¥çœ‹ `proto-sap-backend` å®¹å™¨çŠ¶æ€
3. æ£€æŸ¥ **Ports** åˆ—ï¼Œåº”è¯¥æ˜¾ç¤ºç±»ä¼¼:
   ```
   5000/tcp -> 0.0.0.0:5000
   ```

å¦‚æœæ˜¾ç¤ºä¸ºçº¢è‰²æˆ–æ— æ³•çœ‹åˆ°ç«¯å£æ˜ å°„ï¼Œè¯´æ˜ç«¯å£æ˜ å°„å¤±è´¥ã€‚

### 2ï¸âƒ£ æ£€æŸ¥Stackéƒ¨ç½²é…ç½®

åœ¨Portainerä¸­ï¼š
1. è¿›å…¥ **Stacks**
2. æ‰¾åˆ° `proto-sap` Stack
3. ç‚¹å‡» **Editor** æŸ¥çœ‹YAMLé…ç½®
4. ç¡®è®¤ `backend` æœåŠ¡çš„ `ports` éƒ¨åˆ†:
   ```yaml
   ports:
     - "5000:5000"
   ```
   åº”è¯¥æ˜¾ç¤ºè¿™ä¸ªï¼Œæˆ–è€…ï¼š
   ```yaml
   ports:
     - "${APP_PORT:-5000}:5000"
   ```

### 3ï¸âƒ£ æµ‹è¯•å®¹å™¨å†…è¿æ¥

ä»Dockerä¸»æœºè¿è¡Œï¼š
```bash
# æµ‹è¯•å®¹å™¨æ˜¯å¦åœ¨è¿è¡Œ
docker ps | grep proto-sap-backend

# è¿›å…¥å®¹å™¨æµ‹è¯•
docker exec proto-sap-backend curl http://localhost:5000/

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs proto-sap-backend
```

### 4ï¸âƒ£ æ£€æŸ¥ç«¯å£æ˜ å°„

```bash
# æŸ¥çœ‹å®¹å™¨çš„ç«¯å£æ˜ å°„
docker inspect proto-sap-backend | grep -A 10 "PortBindings"

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼:
# "5000/tcp": [{"HostIp": "0.0.0.0", "HostPort": "5000"}]
```

### 5ï¸âƒ£ æ£€æŸ¥é˜²ç«å¢™

```bash
# Windows
netstat -ano | findstr :5000

# Linux
netstat -tlnp | grep 5000
æˆ–
ss -tlnp | grep 5000
```

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆA: é‡æ–°éƒ¨ç½²Stackï¼ˆæ¨èï¼‰

1. **åœæ­¢å¹¶åˆ é™¤å½“å‰Stack**
   - åœ¨Portainerä¸­è¿›å…¥ Stacks
   - é€‰æ‹© `proto-sap`
   - ç‚¹å‡» **Remove** åˆ é™¤

2. **æ£€æŸ¥Stack YAMLé…ç½®**
   - ç¡®ä¿ `portainer-stack.yml` ä¸­çš„ç«¯å£æ˜ å°„æ˜¯ç¡¬ç¼–ç çš„ï¼š
   ```yaml
   backend:
     ports:
       - "5000:5000"  # ç¡®ä¿æ˜¯ç¡¬ç¼–ç ï¼Œä¸æ˜¯å˜é‡
   ```

3. **é‡æ–°éƒ¨ç½²**
   - Stacks â†’ Add Stack
   - Upload `portainer-stack.yml`
   - ä¸è¦ä¿®æ”¹ä»»ä½•é…ç½®ï¼Œç›´æ¥ Deploy

### æ–¹æ¡ˆB: åœ¨Portainerä¸­æ‰‹åŠ¨è®¾ç½®ç«¯å£

å¦‚æœå·²ç»éƒ¨ç½²ï¼Œå¯ä»¥åœ¨Portainerä¸­ä¿®æ”¹ï¼š

1. è¿›å…¥ Containers
2. ç‚¹å‡» `proto-sap-backend`
3. æŸ¥çœ‹ **Ports** éƒ¨åˆ†
4. å¦‚æœæ²¡æœ‰æ­£ç¡®æ˜ å°„ï¼Œåˆ é™¤æ­¤å®¹å™¨
5. é‡æ–°éƒ¨ç½²Stackï¼ˆå‚è€ƒæ–¹æ¡ˆAï¼‰

### æ–¹æ¡ˆC: ä¿®æ”¹Stackä¸­çš„ç¯å¢ƒå˜é‡

åœ¨Stackéƒ¨ç½²æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

ç‚¹å‡» **Environment variables** æ·»åŠ ï¼š
```
APP_PORT=5000
```

ç¡®ä¿è¿™ä¸ªå˜é‡åœ¨Stack YAMLä¸­è¢«æ­£ç¡®ä½¿ç”¨ï¼š
```yaml
ports:
  - "${APP_PORT}:5000"
```

## âœ… éªŒè¯è®¿é—®æˆåŠŸ

éƒ¨ç½²å®Œæˆåï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºéªŒè¯ï¼š

### 1. æ£€æŸ¥å®¹å™¨æ—¥å¿—
```bash
docker logs proto-sap-backend | tail -20
# åº”è¯¥çœ‹åˆ°: Running on http://0.0.0.0:5000
```

### 2. å®¹å™¨å†…éƒ¨æµ‹è¯•
```bash
docker exec proto-sap-backend curl http://localhost:5000/
# åº”è¯¥è¿”å›HTMLå“åº”ï¼ˆç™»å½•é¡µé¢ï¼‰
```

### 3. ä»Dockerä¸»æœºæµ‹è¯•
```bash
# å¦‚æœæ˜¯æœ¬åœ°è¿è¡Œ
curl http://localhost:5000/

# æˆ–ä½¿ç”¨Dockerç½‘ç»œIP
docker inspect proto-sap-backend | grep IPAddress
# ç„¶åæµ‹è¯•: curl http://[container-ip]:5000/
```

### 4. ä»å¤–éƒ¨è®¿é—®
```bash
# ä½¿ç”¨Dockerä¸»æœºçš„å®é™…IPæˆ–åŸŸå
curl http://[docker-host-ip]:5000/
```

## ğŸŒ è®¿é—®åœ°å€æ€»ç»“

| è®¿é—®æ–¹å¼ | åœ°å€ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| å®¹å™¨å†… | `http://localhost:5000` | å®¹å™¨å†…éƒ¨åº”ç”¨è®¿é—® |
| å®¹å™¨é—´ | `http://proto-sap-backend:5000` | å…¶ä»–å®¹å™¨è®¿é—® |
| Dockerä¸»æœº | `http://localhost:5000` æˆ– `http://127.0.0.1:5000` | æœ¬åœ°æµ‹è¯• |
| è¿œç¨‹è®¿é—® | `http://[docker-host-ip]:5000` | å¤–éƒ¨åº”ç”¨è®¿é—® |
| **ä¸è¦ä½¿ç”¨** | `http://172.22.0.3:5000` | âŒ å®¹å™¨å†…éƒ¨IPï¼Œæ— æ³•ä»å¤–éƒ¨è®¿é—® |

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ 172.22.0.3 æ— æ³•è®¿é—®ï¼Ÿ

**A:** è¿™æ˜¯å®¹å™¨å†…éƒ¨åˆ†é…çš„IPåœ°å€ï¼Œåªåœ¨Dockerç½‘ç»œå†…å¯è§ã€‚è¦ä»å¤–éƒ¨è®¿é—®ï¼Œå¿…é¡»é€šè¿‡å®¿ä¸»æœºçš„ç«¯å£æ˜ å°„ã€‚

### Q2: å¦‚ä½•æ‰¾åˆ°Dockerä¸»æœºçš„IP?

**A:** 
```bash
# Windows/Linux
ipconfig (Windows) æˆ– ifconfig (Linux)

# é€šå¸¸æ˜¯ä½ è¿è¡ŒDockerçš„æœºå™¨çš„IP
# æˆ–è€…åœ¨Portainerä¸­æŸ¥çœ‹ç¯å¢ƒä¿¡æ¯
```

### Q3: ç«¯å£5000è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

**A:** ä¿®æ”¹ `portainer-stack.yml`:
```yaml
ports:
  - "8080:5000"  # ä½¿ç”¨ä¸»æœº8080ç«¯å£æ˜ å°„åˆ°å®¹å™¨5000
```
ç„¶åè®¿é—® `http://docker-host:8080`

### Q4: å¥åº·æ£€æŸ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** 
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker logs proto-sap-backend

# å¸¸è§åŸå› ï¼š
# 1. curlå‘½ä»¤ä¸å¯ç”¨ - ä¿®æ”¹healthcheckä¸ºå…¶ä»–æ–¹å¼
# 2. åº”ç”¨å¯åŠ¨å¤ªæ…¢ - å¢åŠ  start_period
# 3. åº”ç”¨å®é™…æ— æ³•è¿è¡Œ - æ£€æŸ¥æ—¥å¿—
```

## ğŸ” æ•…éšœæ’æŸ¥checklist

- [ ] æ£€æŸ¥å®¹å™¨æ˜¯å¦åœ¨è¿è¡Œ: `docker ps | grep proto-sap`
- [ ] æ£€æŸ¥ç«¯å£æ˜ å°„: `docker inspect proto-sap-backend | grep Port`
- [ ] æŸ¥çœ‹å®¹å™¨æ—¥å¿—: `docker logs proto-sap-backend`
- [ ] æµ‹è¯•å®¹å™¨å†…è¿æ¥: `docker exec proto-sap-backend curl http://localhost:5000/`
- [ ] æ£€æŸ¥é˜²ç«å¢™: 5000ç«¯å£æ˜¯å¦å¼€æ”¾
- [ ] ç¡®è®¤è®¿é—®åœ°å€: ä½¿ç”¨ `localhost:5000` è€Œé `172.22.0.3:5000`
- [ ] æ£€æŸ¥å¥åº·çŠ¶æ€: å®¹å™¨æ˜¯å¦ä¸º"healthy"çŠ¶æ€

## ğŸ“‹ é‡æ–°éƒ¨ç½²æ­¥éª¤

å¦‚æœä»¥ä¸Šéƒ½æ£€æŸ¥è¿‡è¿˜æ˜¯æ— æ³•è®¿é—®ï¼š

```bash
# 1. åˆ é™¤ç°æœ‰å®¹å™¨
docker-compose down

# 2. æˆ–é€šè¿‡Portainer
# Stacks â†’ proto-sap â†’ Remove

# 3. é‡æ–°éƒ¨ç½²
docker-compose up -d
# æˆ–
# Stacks â†’ Add Stack â†’ ä¸Šä¼  portainer-stack.yml

# 4. ç­‰å¾…30-60ç§’å®¹å™¨åˆå§‹åŒ–

# 5. å†æ¬¡å°è¯•è®¿é—®
curl http://localhost:5000/
```

## æœ€ç»ˆç¡®è®¤

è®¿é—®æˆåŠŸçš„æ ‡å¿—ï¼š
- âœ… æµè§ˆå™¨æ˜¾ç¤ºç™»å½•é¡µé¢
- âœ… å¯ä»¥è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
- âœ… å¯ä»¥æ­£å¸¸æ³¨å†Œç”¨æˆ·
- âœ… å¯ä»¥æŸ¥çœ‹é‡‡è´­å•åˆ—è¡¨

å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥åº”ç”¨æ—¥å¿—ï¼š
```bash
docker logs -f proto-sap-backend
```

æŸ¥çœ‹æ˜¯å¦æœ‰åº”ç”¨çº§åˆ«çš„é”™è¯¯ï¼ˆå¦‚æ•°æ®åº“è¿æ¥å¤±è´¥ï¼‰ã€‚
